# C++ é€šç”¨çº¿ç¨‹æ± 

**ä¸€ä¸ªç®€å•å®ç”¨çš„çº¿ç¨‹æ± ï¼Œä½¿ç”¨æ–¹å¼åŠæ ·ä¾‹è¯¦è§ UnitTest.cpp**ã€‚è¯¥çº¿ç¨‹æ± å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š

1. **ä½¿ç”¨ç®€å•ä¾¿æ·**ã€‚åªéœ€åœ¨éœ€è¦çš„åœ°æ–¹åŒ…å« `ThreadPool.h` å¤´æ–‡ä»¶å³å¯ã€‚é€šè¿‡ `wxm::ThreadPool pool;`ï¼ˆå¯æŒ‡å®šæ„é€ å‡½æ•°å‚æ•°ï¼‰åˆ›å»ºçº¿ç¨‹æ± åï¼Œå³å¯æäº¤ä»»åŠ¡ã€‚

   ```C++
   // UnitTest.cpp ä¸­çš„æµ‹è¯•ç¤ºä¾‹ï¼šæ— å‚æ— è¿”å›å€¼ä»»åŠ¡çš„æäº¤ï¼ˆè§ test_no_argument_no_ret()ï¼‰
   int initialSize = 24;
   wxm::ThreadPool pool(initialSize, 50, false, 1000);
   try {
       for (int i = 0; i < Task::taskNum; ++i) {
           pool.submit_task(&Task::task1);
       }
   }
   catch (const std::exception& e) {
       std::cerr << e.what() << std::endl;
   }
   
   // UnitTest.cpp ä¸­çš„ç¤ºä¾‹ï¼šæœ‰å‚æœ‰è¿”å›å€¼ä»»åŠ¡çš„æäº¤ä»¥åŠç»“æœçš„è·å–ï¼ˆè§ test_have_argument_have_ret()ï¼‰
   int initialSize = 24;
   wxm::ThreadPool pool(initialSize, 50, false, 1000);
   try {
       std::vector<std::future<int>> results;
       for (int i = 0; i < Task::taskNum; ++i) {
           std::future<int> res = pool.submit_task(&Task::task2, std::ref(Task::num)); // å¼‚æ­¥è·å–ç»“æœ
           results.push_back(std::move(res));
       }
   
       for (auto& future : results) {
           future.wait(); // å¼‚æ­¥ç­‰å¾…ç»“æœ
       }
   
       std::cout << "Output the results: \n";
       for (auto& future : results) {
           std::cout << future.get() << ' ';
       }
       std::cout << '\n';
   }
   catch (const std::exception& e) {
       std::cerr << e.what() << std::endl;
   }
   ```

2. **æ”¯æŒä»»ä½•ä»»åŠ¡çš„å¼‚æ­¥æ‰§è¡Œå’Œç»“æœè·å–**ã€‚å¯æ‰§è¡Œä»»æ„ç±»å‹çš„ä»»åŠ¡ï¼Œå¹¶é€šè¿‡ `std::future` å¼‚æ­¥è·å–ä»»åŠ¡è¿”å›å€¼ã€‚

3. **æ”¯æŒçº¿ç¨‹æ± è‡ªåŠ¨ä¼¸ç¼©**ã€‚é€šè¿‡æ„é€ å‡½æ•°å‚æ•° `_maxWaitTime` è®¾å®šæœŸæœ›çš„ä»»åŠ¡å¤„ç†é€Ÿç‡ï¼Œçº¿ç¨‹æ± å°†æ®æ­¤è‡ªåŠ¨è°ƒæ•´çº¿ç¨‹æ•°é‡ä»¥æ»¡è¶³æ€§èƒ½éœ€æ±‚ã€‚å…·ä½“è§£é‡Šå¦‚ä¸‹ï¼š

   - **ç†è®ºä¸ŠæœŸæœ›å¤„ç†é€Ÿç‡ $\mathrm{ Expect(v) \geq (1/\\_maxWaitTime) \times numOfThread }$ï¼ˆå•ä½ï¼šä»»åŠ¡/ç§’ï¼‰**ï¼Œå…¶ä¸­ $\mathrm{numOfThread}$ ä¸º**æäº¤ä»»åŠ¡çš„çº¿ç¨‹æ•°é‡**ï¼ˆéçº¿ç¨‹æ± å¤§å°ï¼‰ã€‚è‹¥å½“å‰çº¿ç¨‹æ± æ— æ³•è¾¾åˆ°è¯¥é€Ÿç‡ï¼Œå…¶ä¼šè‡ªåŠ¨æ‰©å®¹ç›´åˆ°æ»¡è¶³è¯¥é€Ÿç‡æˆ–ç›´è‡³çº¿ç¨‹æ•°é‡è¾¾åˆ°2* æœ€å¤§æ ¸å¿ƒæ•°ã€‚è‹¥æ‰©å®¹åˆ°2* æœ€å¤§æ ¸å¿ƒæ•°ä¹Ÿè¾¾ä¸åˆ°æœŸæœ›é€Ÿç‡ï¼Œæ­¤æ—¶å±äºç¡¬ä»¶æ€§èƒ½å—é™ï¼Œçº¿ç¨‹æ± å°†ç»´æŒåœ¨2* æœ€å¤§æ ¸å¿ƒæ•°ã€‚

     **ä¸¾ä¾‹**ï¼šè‹¥æœŸæœ›æ¯ç§’å¤„ç† 5 ä¸ªä»»åŠ¡ï¼Œä¸”ä»…æœ‰ä¸€ä¸ªä»»åŠ¡æäº¤çº¿ç¨‹ï¼Œåˆ™ $\mathrm{5 = (1/\\_maxWaitTime) \times 1}$ï¼Œå¯è®¡ç®—å¾— $\mathrm{\\_maxWaitTime = 0.2\ s = 200\ ms}$ã€‚

   - **ç†è®ºä¸Šå®é™…å¤„ç†é€Ÿç‡ $\mathrm{ Real(v) \geq (1/\\_maxWaitTime) \times numOfThreads}$ï¼ˆå•ä½ï¼šä»»åŠ¡/ç§’ï¼‰**ï¼Œå…¶ä¸­ $\mathrm{numOfThreads}$ ä¸º**çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡**ã€‚è‹¥çº¿ç¨‹æ± å¤„ç†èƒ½åŠ›è¶…å‡ºä»»åŠ¡æäº¤é€Ÿç‡ï¼Œçº¿ç¨‹æ± å°†è‡ªåŠ¨ç¼©å‡çº¿ç¨‹æ•°é‡ï¼Œç›´åˆ°çº¿ç¨‹æ± å¤§å°è¾¾åˆ°æ»¡è¶³ $\mathrm{E(v)}$ æ¡ä»¶ä¸‹çº¿ç¨‹æ± å¤§å°çš„ä¸‹ç•Œã€‚ã€‚

   é€šå¸¸é€»è¾‘æ˜¯ï¼Œç”¨æˆ·è®¾æƒ³ä¸€ä¸ªé¢„æœŸå¤„ç†é€Ÿç‡ï¼ˆå•ä½ï¼šä»»åŠ¡/ç§’ï¼‰ï¼Œç„¶åè®¡ç®—å¹¶è®¾ç½® `_maxWaitTime`ã€‚è‹¥ä»»åŠ¡æ‰§è¡Œæ—¶é—´è¾ƒé•¿å¯¼è‡´å®é™…ä»»åŠ¡å¤„ç†é€Ÿç‡ä½äºé¢„æœŸï¼Œçº¿ç¨‹æ± å°†è‡ªåŠ¨æ‰©å®¹ç›´è‡³æ»¡è¶³è¦æ±‚æˆ–è¾¾åˆ°2* æœ€å¤§æ ¸å¿ƒæ•°ï¼›è‹¥çº¿ç¨‹æ± å¤„ç†èƒ½åŠ›è¶…å‡ºä»»åŠ¡æäº¤é€Ÿç‡ï¼Œçº¿ç¨‹æ± å°†è‡ªåŠ¨ç¼©å‡çº¿ç¨‹æ•°é‡ã€‚

4. **æ”¯æŒä¼˜å…ˆçº§è°ƒåº¦**ã€‚å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡æ—¶å¯æŒ‡å®šä»»åŠ¡ä¼˜å…ˆçº§ï¼ˆint ç±»å‹ï¼‰ï¼Œæ•°å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼›ä¸ä¼ å…¥ä»»åŠ¡çš„ä¼˜å…ˆçº§åˆ™ä¼˜å…ˆçº§ç»Ÿä¸€é»˜è®¤ä¸º 0ã€‚çº¿ç¨‹æ± å°†æ ¹æ®ä»»åŠ¡é˜Ÿåˆ—ä¸­ä»»åŠ¡çš„ä¼˜å…ˆçº§è¿›è¡Œè°ƒåº¦ï¼ˆ**è‹¥ä¸è®¾ç½®ä»»åŠ¡ä¼˜å…ˆçº§ï¼Œå³ä»»åŠ¡ä¼˜å…ˆçº§ç›¸åŒä¸º 0ï¼Œæ­¤æ—¶é»˜è®¤ FCFS è°ƒåº¦**ï¼‰ã€‚ç”¨æˆ·å¯å°†ä¼˜å…ˆçº§è§†ä¸ºä»»åŠ¡ç­‰çº§ï¼ˆrankï¼‰æˆ–é¢„ä¼°æ‰§è¡Œæ—¶é—´ï¼ˆæ­¤æ—¶**ç±»ä¼¼æœ€çŸ­ä»»åŠ¡ä¼˜å…ˆè°ƒåº¦**ï¼‰ã€‚è¯·æ³¨æ„ï¼šè¯¥æœºåˆ¶ä»…ä¿è¯é«˜ä¼˜å…ˆçº§ä»»åŠ¡å…ˆè¢«è°ƒåº¦ï¼Œè€Œä¸ä¿è¯å…¶å…ˆæ‰§è¡Œå®Œæˆï¼ˆè¿™å’Œä»»åŠ¡æœ¬èº«ç›¸å…³ï¼Œçº¿ç¨‹æ± æ— æ³•ä¿è¯ï¼‰ã€‚

5. **More features await coding**...

**æç¤º**ï¼šæœ¬ä»£ç ä½¿ç”¨äº† C++11 ç‰¹æ€§ã€‚<ins>ä»£ç æ³¨é‡Šè¯¦å°½ã€æ˜“äºç†è§£ã€‚å¦‚æœå¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç»™äºˆ Star ğŸ¤ğŸ¤ğŸ¤ï¼Œéå¸¸æ„Ÿè°¢ï¼</ins>
